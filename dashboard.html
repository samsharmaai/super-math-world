<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario Math: Parent Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Verdana&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Verdana', sans-serif; background: #f0f2f5; padding: 20px; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        
        /* LOGIN */
        #login-section { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 50px; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 250px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }

        /* DASHBOARD */
        #dashboard-section { display: none; text-align: left; }
        .summary-cards { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd; }
        .card h3 { margin: 0; font-size: 0.9em; color: #666; }
        .card .number { font-size: 2em; font-weight: bold; color: #333; }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background-color: #007bff; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        
        .progress-bar-bg { width: 100%; background-color: #e0e0e0; border-radius: 10px; height: 10px; overflow: hidden; }
        .progress-bar-fill { height: 100%; transition: width 0.5s; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸ“Š Math Performance Report</h1>

        <div id="login-section">
            <p>Please login to view protected data.</p>
            <input type="email" id="email" placeholder="Email" value="mario@math.com">
            <input type="password" id="password" placeholder="Password">
            <button onclick="loginAndFetch()">VIEW REPORT</button>
            <p id="error-msg" style="color:red; font-size: 0.8em;"></p>
        </div>

        <div id="dashboard-section">
            <div class="summary-cards">
                <div class="card">
                    <h3>Total Questions</h3>
                    <div class="number" id="total-q">0</div>
                </div>
                <div class="card">
                    <h3>Overall Accuracy</h3>
                    <div class="number" id="total-acc">0%</div>
                </div>
                <div class="card">
                    <h3>Strongest Subject</h3>
                    <div class="number" id="top-subject" style="font-size:1em; margin-top:10px;">-</div>
                </div>
            </div>

            <h2>Performance by Category</h2>
            <table id="category-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Attempts</th>
                        <th>Accuracy</th>
                        <th>Visual</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- PASTE YOUR FIREBASE KEYS HERE ---

         const firebaseConfig = {
            apiKey: "AIzaSyC3aHdoyrVWmOwnM5cEn3mueyEzG_QdBN0",
            authDomain: "super-math-tracker.firebaseapp.com",
            projectId: "super-math-tracker",
            storageBucket: "super-math-tracker.firebasestorage.app",
            messagingSenderId: "193983274782",
            appId: "1:193983274782:web:bab9f49ce52df2802e730f",
            measurementId: "G-RB7770405Z"
        };

      

        try {
            firebase.initializeApp(firebaseConfig);
            var db = firebase.firestore();
            var auth = firebase.auth();
        } catch(e) { console.error("Firebase Error"); }

        function loginAndFetch() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const btn = document.querySelector('button');
            
            btn.innerText = "Loading Data...";

            auth.signInWithEmailAndPassword(email, pass)
                .then(() => {
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('dashboard-section').style.display = 'block';
                    generateReport();
                })
                .catch((error) => {
                    btn.innerText = "VIEW REPORT";
                    document.getElementById('error-msg').innerText = error.message;
                });
        }

        async function generateReport() {
            // Get all logs
            const snapshot = await db.collection("math_logs").get();
            const logs = snapshot.docs.map(doc => doc.data());

            if(logs.length === 0) {
                alert("No data found! Go play the game first.");
                return;
            }

            // --- 1. AGGREGATE DATA ---
            const stats = {};
            let totalCorrect = 0;

            logs.forEach(log => {
                const cat = log.category || "General";
                if(!stats[cat]) stats[cat] = { total: 0, correct: 0 };
                
                stats[cat].total++;
                if(log.result === "Correct") {
                    stats[cat].correct++;
                    totalCorrect++;
                }
            });

            // --- 2. UPDATE SUMMARY CARDS ---
            document.getElementById('total-q').innerText = logs.length;
            document.getElementById('total-acc').innerText = Math.round((totalCorrect / logs.length) * 100) + "%";

            // Find best subject
            let bestSub = "-";
            let bestRate = -1;
            for(const cat in stats) {
                const rate = stats[cat].correct / stats[cat].total;
                if(rate > bestRate) { bestRate = rate; bestSub = cat; }
            }
            document.getElementById('top-subject').innerText = bestSub;

            // --- 3. BUILD TABLE ---
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = "";

            for(const cat in stats) {
                const row = stats[cat];
                const percentage = Math.round((row.correct / row.total) * 100);
                
                // Color code the bar
                let color = "#dc3545"; // Red (Bad)
                if(percentage >= 50) color = "#ffc107"; // Yellow (Okay)
                if(percentage >= 80) color = "#28a745"; // Green (Good)

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight:bold;">${cat}</td>
                    <td>${row.total}</td>
                    <td>${percentage}%</td>
                    <td style="width:40%;">
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" style="width:${percentage}%; background-color:${color};"></div>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            }
        }
    </script>
</body>
</html>
